<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of estim_para_krg_ckrg</title>
  <meta name="keywords" content="estim_para_krg_ckrg">
  <meta name="description" content="% Fonction assurant l'estimation des parametres (longueur de correlation)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html GRENAT --><!-- # routines --><!-- menu.html meta -->
<h1>estim_para_krg_ckrg
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% Fonction assurant l'estimation des parametres (longueur de correlation)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function para_estim=estim_para_krg_ckrg(donnees,meta) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Fonction assurant l'estimation des parametres (longueur de correlation)
 L. LAURENT -- 14/12/2011 -- laurent@lmt.ens-cachan.fr</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GRENAT/routines/divers/mesu_time.html" class="code" title="function [tictoc_compt,tInit]=mesu_time(compteur,tps_init)">mesu_time</a>	% Fonction assurant l'initialisation et l'affichage des infos temporelles dans les fonctions</li><li><a href="../../../GRENAT/routines/libs/PSOt/pso_Trelea_mod.html" class="code" title="function [OUT,varargout]=pso_Trelea_mod(functname,D,varargin)">pso_Trelea_mod</a>	%%%%%%</li><li><a href="bloc_krg_ckrg.html" class="code" title="function [lilog,ret]=bloc_krg_ckrg(donnees,meta,para)">bloc_krg_ckrg</a>	% Construction des blocs du Krigeage</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="meta_krg_ckrg.html" class="code" title="function [ret]=meta_krg_ckrg(tirages,eval,grad,meta,manq)">meta_krg_ckrg</a>	% fonction de construction des metamodeles de Krigeage et de Cokrigeage</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Fonction assurant l'estimation des parametres (longueur de correlation)</span>
0002 <span class="comment">% L. LAURENT -- 14/12/2011 -- laurent@lmt.ens-cachan.fr</span>
0003 
0004 <a name="_sub0" href="#_subfunctions" class="code">function para_estim=estim_para_krg_ckrg(donnees,meta)</a>
0005 <span class="comment">% affichages warning ou non</span>
0006 aff_warning=false;
0007 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0008 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0009 <span class="comment">% Definition des parametres de minimisation</span>
0010 <span class="comment">% Nombre de parametres a estimer</span>
0011 <span class="comment">%anisotropie</span>
0012 <span class="keyword">if</span> meta.para.aniso
0013     nb_para=donnees.in.nb_var;
0014     nb_para_optim=nb_para;
0015 <span class="keyword">else</span>
0016     nb_para=1;
0017     nb_para_optim=nb_para;
0018 <span class="keyword">end</span>
0019 
0020 <span class="comment">%critere arret minimisation</span>
0021 crit_opti=meta.para.crit_opti;
0022 
0023 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0024 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0025 fprintf(<span class="string">' - - - - - - - - - - - - - - - - - - - - \n'</span>)
0026 fprintf(<span class="string">'      &gt; Estimation parametres &lt;\n'</span>);
0027 fprintf(<span class="string">' - - - - - - - - - - - - - - - - - - - - \n'</span>)
0028 [tMesu,tInit]=<a href="../../../GRENAT/routines/divers/mesu_time.html" class="code" title="function [tictoc_compt,tInit]=mesu_time(compteur,tps_init)">mesu_time</a>;
0029 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0030 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0031 <span class="comment">% traitement des cas particuliers (fonctions de correlation exponentielles</span>
0032 <span class="comment">% generalisees)</span>
0033 <span class="keyword">switch</span> meta.corr
0034     <span class="keyword">case</span> <span class="string">'corr_expg'</span>
0035         <span class="comment">%definition des bornes de l'espace de recherche</span>
0036         lb=[meta.para.l_min*ones(1,nb_para) meta.para.p_min];
0037         ub=[meta.para.l_max*ones(1,nb_para) meta.para.p_max];
0038         nb_para_optim=nb_para+1;
0039     <span class="keyword">case</span> <span class="string">'corr_expgg'</span>
0040         <span class="comment">%definition des bornes de l'espace de recherche</span>
0041         lb=[meta.para.l_min*ones(1,nb_para) meta.para.p_min*ones(1,nb_para)];
0042         ub=[meta.para.l_max*ones(1,nb_para) meta.para.p_max*ones(1,nb_para)];
0043         nb_para_optim=2*nb_para;
0044     <span class="keyword">otherwise</span>
0045         <span class="comment">%definition des bornes de l'espace de recherche</span>
0046         lb=meta.para.l_min*ones(1,nb_para);ub=meta.para.l_max*ones(1,nb_para);
0047 <span class="keyword">end</span>
0048 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0049 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0050 <span class="comment">%on recherche si le motif tir_min_ est present dans le nom de strategie</span>
0051 motif=<span class="string">'tir_min_'</span>;
0052 [motfind]=strfind(meta.para.method,motif);
0053 
0054 <span class="keyword">if</span> isempty(motfind)
0055     method_optim=meta.para.method;
0056     tir_min_ok=false;
0057 <span class="keyword">else</span>
0058     method_optim=meta.para.method((motfind+numel(motif)):end);
0059     tir_min_ok=true;
0060 <span class="keyword">end</span>
0061 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0062 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0063 <span class="comment">%Definition manuelle de la population initiale par LHS/IHS (Ga)</span>
0064 popInitManu=meta.para.popManu;
0065 <span class="keyword">if</span> popInitManu
0066     nbpopspecif=false;
0067     <span class="keyword">if</span> isfield(meta.para,<span class="string">'nbPopInit'</span>);<span class="keyword">if</span> ~isempty(meta.para.nbPopInit);nbpopspecif=false;<span class="keyword">end</span>, <span class="keyword">end</span>
0068     <span class="keyword">if</span> nbpopspecif;nbPopInit=meta.para.nbPopInit;<span class="keyword">else</span> nbPopInit=10*nb_para_optim; <span class="keyword">end</span>
0069 <span class="keyword">end</span>
0070 
0071 <span class="comment">%definition valeur de depart de la variable</span>
0072 x0=lb+1/5*(ub-lb);
0073 <span class="comment">% Definition de la function a minimiser</span>
0074 fun=@(para)<a href="bloc_krg_ckrg.html" class="code" title="function [lilog,ret]=bloc_krg_ckrg(donnees,meta,para)">bloc_krg_ckrg</a>(donnees,meta,para);
0075 <span class="comment">%Options algo pour chaque fonction de minimisation</span>
0076 <span class="comment">%declaration des options de la strategie de minimisation</span>
0077 options_fmincon = optimset(<span class="keyword">...</span>
0078     <span class="string">'Display'</span>, <span class="string">'iter'</span>,<span class="keyword">...</span><span class="comment">        %affichage evolution</span>
0079     <span class="string">'Algorithm'</span>,<span class="string">'interior-point'</span>,<span class="keyword">...</span><span class="comment"> %choix du type d'algorithme</span>
0080     <span class="string">'OutputFcn'</span>,@stop_estim,<span class="keyword">...</span><span class="comment">      %fonction assurant l'arret de la procedure de minimisation et les traces des iterations de la minimisation</span>
0081     <span class="string">'FunValCheck'</span>,<span class="string">'off'</span>,<span class="keyword">...</span><span class="comment">      %test valeur fonction (Nan,Inf)</span>
0082     <span class="string">'UseParallel'</span>,<span class="string">'never'</span>,<span class="keyword">...</span>
0083     <span class="string">'PlotFcns'</span>,<span class="string">''</span>,<span class="keyword">...</span><span class="comment">   %{@optimplotx,@optimplotfunccount,@optimplotstepsize,@optimplotfirstorderopt,@optimplotconstrviolation,@optimplotfval}</span>
0084     <span class="string">'TolFun'</span>,crit_opti);
0085 options_sqp = optimset(<span class="keyword">...</span>
0086     <span class="string">'Display'</span>, <span class="string">'iter'</span>,<span class="keyword">...</span><span class="comment">        %affichage evolution</span>
0087     <span class="string">'Algorithm'</span>,<span class="string">'sqp'</span>,<span class="keyword">...</span><span class="comment"> %choix du type d'algorithme</span>
0088     <span class="string">'OutputFcn'</span>,@stop_estim,<span class="keyword">...</span><span class="comment">      %fonction assurant l'arret de la procedure de minimisation et les traces des iterations de la minimisation</span>
0089     <span class="string">'FunValCheck'</span>,<span class="string">'off'</span>,<span class="keyword">...</span><span class="comment">      %test valeur fonction (Nan,Inf)</span>
0090     <span class="string">'UseParallel'</span>,<span class="string">'never'</span>,<span class="keyword">...</span>
0091     <span class="string">'PlotFcns'</span>,<span class="string">''</span>,<span class="keyword">...</span><span class="comment">   %{@optimplotx,@optimplotfunccount,@optimplotstepsize,@optimplotfirstorderopt,@optimplotconstrviolation,@optimplotfval}</span>
0092     <span class="string">'TolFun'</span>,crit_opti,<span class="keyword">...</span>
0093     <span class="string">'MaxFunEvals'</span>,2000,<span class="keyword">...</span><span class="comment"> %nombre maxi d'iterations (3000 pour interior-point)</span>
0094     <span class="string">'TolX'</span>,1e-8);
0095 options_fminbnd = optimset(<span class="keyword">...</span>
0096     <span class="string">'Display'</span>, <span class="string">'iter'</span>,<span class="keyword">...</span><span class="comment">        %affichage evolution</span>
0097     <span class="string">'OutputFcn'</span>,@stop_estim,<span class="keyword">...</span><span class="comment">      %fonction assurant l'arret de la procedure de minimisation et les traces des iterations de la minimisation</span>
0098     <span class="string">'FunValCheck'</span>,<span class="string">'off'</span>,<span class="keyword">...</span><span class="comment">      %test valeur fonction (Nan,Inf)</span>
0099     <span class="string">'UseParallel'</span>,<span class="string">'never'</span>,<span class="keyword">...</span>
0100     <span class="string">'PlotFcns'</span>,<span class="string">''</span>);
0101 options_ga = gaoptimset(<span class="keyword">...</span>
0102     <span class="string">'Display'</span>, <span class="string">'iter'</span>,<span class="keyword">...</span><span class="comment">        %affichage evolution</span>
0103     <span class="string">'OutputFcn'</span>,@stop_estim,<span class="keyword">...</span><span class="comment">      %fonction assurant l'arret de la procedure de minimisation et les traces des iterations de la minimisation</span>
0104     <span class="string">'PopInitRange'</span>,[lb(:)';ub(:)'],<span class="keyword">...</span><span class="comment">  %zone de dï¿½finition de la population initiale</span>
0105     <span class="string">'UseParallel'</span>,<span class="string">'always'</span>,<span class="keyword">...</span>
0106     <span class="string">'PlotFcns'</span>,<span class="string">''</span>,<span class="keyword">...</span>
0107     <span class="string">'TolFun'</span>,crit_opti,<span class="keyword">...</span>
0108     <span class="string">'StallGenLimit'</span>,50);
0109 options_fminsearch = optimset(<span class="keyword">...</span>
0110     <span class="string">'Display'</span>, <span class="string">'iter'</span>,<span class="keyword">...</span><span class="comment">        %affichage evolution</span>
0111     <span class="string">'OutputFcn'</span>,@stop_estim,<span class="keyword">...</span><span class="comment">      %fonction assurant l'arret de la procedure de minimisation et les traces des iterations de la minimisation</span>
0112     <span class="string">'FunValCheck'</span>,<span class="string">'off'</span>,<span class="keyword">...</span><span class="comment">      %test valeur fonction (Nan,Inf)</span>
0113     <span class="string">'TolFun'</span>,crit_opti,<span class="keyword">...</span>
0114     <span class="string">'PlotFcns'</span>,<span class="string">''</span>);
0115 <span class="comment">%%%%% PSOt</span>
0116 <span class="comment">%options algo PSO de la toolbox PSOt</span>
0117 ac      = [2.1,2.1];<span class="comment">% acceleration constants, only used for modl=0</span>
0118 Iwt     = [0.9,0.6];  <span class="comment">% intertia weights, only used for modl=0</span>
0119 epoch   = 2000; <span class="comment">% max iterations</span>
0120 wt_end  = 100; <span class="comment">% iterations it takes to go from Iwt(1) to Iwt(2), only for modl=0</span>
0121 errgrad = 1e-25;   <span class="comment">% lowest error gradient tolerance</span>
0122 errgraditer=150; <span class="comment">% max # of epochs without error change &gt;= errgrad</span>
0123 PSOseed = 0;    <span class="comment">% if=1 then can input particle starting positions, if= 0 then all random</span>
0124 <span class="comment">% starting particle positions (first 20 at zero, just for an example)</span>
0125 PSOT_plot=[];
0126 PSOT_tirage = [];
0127 PSOT_mv=4; <span class="comment">%vitesse maxi des particules (=4 def)</span>
0128 shw=0;      <span class="comment">%MAJ affichage a chque iteration (0 sinon)</span>
0129 ps=nbPopInit; <span class="comment">%nb de particules</span>
0130 errgoal=NaN;    <span class="comment">%cible minimisation</span>
0131 modl=3;         <span class="comment">%type de PSO</span>
0132 <span class="comment">%                   0 = Common PSO w/intertia (default)</span>
0133 <span class="comment">%                 1,2 = Trelea types 1,2</span>
0134 <span class="comment">%                 3   = Clerc's Constricted PSO, Type 1&quot;</span>
0135 
0136 PSOT_options=<span class="keyword">...</span>
0137     [shw epoch ps ac(1) ac(2) Iwt(1) Iwt(2) <span class="keyword">...</span>
0138     wt_end errgrad errgraditer errgoal modl PSOseed];
0139 <span class="comment">%variation des parametres</span>
0140 PSOT_varrange=[lb(:) ub(:)];
0141 <span class="comment">%minimisation</span>
0142 PSOT_minmax=0;
0143 
0144 <span class="comment">%%%%%</span>
0145 
0146 <span class="comment">%affichage des iterations</span>
0147 <span class="keyword">if</span> ~meta.para.aff_iter_graph
0148     options_fmincon=optimset(options_fmincon,<span class="string">'OutputFcn'</span>,<span class="string">''</span>);
0149     options_sqp=optimset(options_sqp,<span class="string">'OutputFcn'</span>,<span class="string">''</span>);
0150     options_fminbnd=optimset(options_fminbnd,<span class="string">'OutputFcn'</span>,<span class="string">''</span>);
0151     options_fminsearch=optimset(options_fminbnd,<span class="string">'OutputFcn'</span>,<span class="string">''</span>);
0152     options_ga=gaoptimset(options_ga,<span class="string">'OutputFcn'</span>,<span class="string">''</span>);
0153 <span class="keyword">else</span>
0154     figure
0155 <span class="keyword">end</span>
0156 <span class="keyword">if</span> ~meta.para.aff_iter_cmd
0157     options_fmincon=optimset(options_fmincon,<span class="string">'Display'</span>, <span class="string">'final'</span>);
0158     options_sqp=optimset(options_sqp,<span class="string">'Display'</span>, <span class="string">'final'</span>);
0159     options_fminbnd=optimset(options_fminbnd,<span class="string">'Display'</span>, <span class="string">'final'</span>);
0160     options_fminsearch=optimset(options_fminbnd,<span class="string">'Display'</span>, <span class="string">'final'</span>);
0161     options_ga=gaoptimset(options_ga,<span class="string">'Display'</span>, <span class="string">'final'</span>);
0162 <span class="keyword">end</span>
0163 
0164 <span class="comment">%affichage informations interations algo (sous forme de plot)</span>
0165 <span class="keyword">if</span> meta.para.aff_plot_algo
0166     options_fmincon=optimset(options_fmincon,<span class="string">'PlotFcns'</span>,{@optimplotx,@optimplotfunccount,<span class="keyword">...</span>
0167         @optimplotstepsize,@optimplotfirstorderopt,@optimplotconstrviolation,@optimplotfval});
0168     options_sqp=optimset(options_sqp,<span class="string">'PlotFcns'</span>,{@optimplotx,@optimplotfunccount,<span class="keyword">...</span>
0169         @optimplotstepsize,@optimplotfirstorderopt,@optimplotconstrviolation,@optimplotfval});
0170     options_ga=gaoptimset(options_ga,<span class="string">'PlotFcns'</span>,{@gaplotbestf,@gaplotbestindiv,@gaplotdistance,<span class="keyword">...</span>
0171         @gaplotexpectation,@gaplotmaxconstr,@gaplotrange,@gaplotselection,<span class="keyword">...</span>
0172         @gaplotscorediversity,@gaplotscores,@gaplotstopping});
0173     <span class="comment">%%PSOT</span>
0174     PSOT_plot=<span class="string">'goplotpso_perso1'</span>;
0175     PSOT_options(1)=10;
0176 <span class="keyword">end</span>
0177 
0178 <span class="comment">%specification manuelle de la population initiale (Ga ou PSOt)</span>
0179 <span class="keyword">if</span> ~isempty(popInitManu)&amp;&amp;~tir_min_ok
0180     <span class="comment">%si la toolbox LMTir est disponible, on l'utilise sinon on fait avec ce</span>
0181     <span class="comment">%qu'on a...</span>
0182     <span class="keyword">if</span> exist(<span class="string">'gene_doe'</span>,<span class="string">'file'</span>)
0183         doePop.Xmin=lb;doePop.Xmax=ub;doePop.nb_samples=nbPopInit;doePop.aff=false;doePop.type=meta.para.popManu;
0184         tir=gene_doe(doePop);
0185         tir_pop=tir.tri;
0186         <span class="comment">%on tente d'utiliser lhsdesign si la toolbox Statistics est dispo</span>
0187     <span class="keyword">elseif</span> exist(<span class="string">'lhsdesign'</span>,<span class="string">'file'</span>)
0188         fprintf(<span class="string">'&gt;&gt; Toolbox LMTir indisponible: usage de lhsdesign\n'</span>)
0189         tir_pop=lhsdesign(nbPopInit,nb_para_optim);
0190         tir_pop=tir_pop.*repmat(ub(:)'-lb(:)',prod(nbPopInit(:)),1)+<span class="keyword">...</span>
0191             repmat(lb(:)',prod(nbPopInit(:)),1);
0192         <span class="comment">%sinon on realise un tirage aleatoire avec rand</span>
0193     <span class="keyword">else</span>
0194         fprintf(<span class="string">'&gt;&gt; Toolbox LMTir et lhsdesign indisponibles: usage de rand\n'</span>)
0195         tir_pop=rand(nbPopInit,nb_para_optim);
0196         tir_pop=tir_pop.*repmat(ub(:)'-lb(:)',prod(nbPopInit(:)),1)+<span class="keyword">...</span>
0197             repmat(lb(:)',prod(nbPopInit(:)),1);
0198     <span class="keyword">end</span>
0199     options_ga=gaoptimset(options_ga,<span class="string">'PopulationSize'</span>,nbPopInit,<span class="string">'InitialPopulation'</span>,tir_pop);
0200     <span class="comment">%PSOt</span>
0201     PSOT_tirage=tir_pop;
0202     PSOT_options(13)=1;
0203 <span class="keyword">end</span>
0204 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0205 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0206 <span class="comment">%% traitement des strategie de type tir_min_xxxx</span>
0207 
0208 <span class="comment">% si tir_min alors on fait un tirage pour rechercher un point</span>
0209 <span class="comment">% d'initialisation de l'algorithme</span>
0210 <span class="keyword">if</span> tir_min_ok
0211     nb_pts=nb_para*10;
0212     type_tir=<span class="string">'LHS_O1'</span>;
0213     fprintf(<span class="string">'||Tir_min + opti||  Tirage %s de %i points\n'</span>,type_tir,nb_pts);
0214     <span class="comment">%si la toolbox LMTir est disponible, on l'utilise sinon on fait avec ce</span>
0215     <span class="comment">%qu'on a...</span>
0216     <span class="keyword">if</span> exist(<span class="string">'gene_doe'</span>,<span class="string">'file'</span>)
0217         doePop.Xmin=lb;doePop.Xmax=ub;doePop.nb_samples=nbPopInit;doePop.aff=false;doePop.type=meta.para.popManu;
0218         tir=gene_doe(doePop);
0219         tir_pop=tir.tri;
0220         <span class="comment">%on tente d'utiliser lhsdesign si la toolbox Statistics est dispo</span>
0221     <span class="keyword">elseif</span> exist(<span class="string">'lhsdesign'</span>,<span class="string">'file'</span>)
0222         fprintf(<span class="string">'&gt;&gt; Toolbox LMTir indisponible: usage de lhsdesign\n'</span>)
0223         tir_pop=lhsdesign(nbPopInit,nb_para_optim);
0224         tir_pop=tir_pop.*repmat(ub(:)'-lb(:)',prod(nbPopInit(:)),1)+<span class="keyword">...</span>
0225             repmat(lb(:)',prod(nbPopInit(:)),1);
0226         <span class="comment">%sinon on realise un tirage aleatoire avec rand</span>
0227     <span class="keyword">else</span>
0228         fprintf(<span class="string">'&gt;&gt; Toolbox LMTir et lhsdesign indisponibles: usage de rand\n'</span>)
0229         tir_pop=rand(nbPopInit,nb_para_optim);
0230         tir_pop=tir_pop.*repmat(ub(:)'-lb(:)',prod(nbPopInit(:)),1)+<span class="keyword">...</span>
0231             repmat(lb(:)',prod(nbPopInit(:)),1);
0232     <span class="keyword">end</span>
0233     crit=zeros(1,nb_pts);
0234     parfor tir=1:nb_pts
0235         crit(tir)=fun(tir_pop(tir,:));
0236     <span class="keyword">end</span>
0237     [fval1,IX]=min(crit);
0238     x0=tir_pop(IX,:);
0239 <span class="keyword">end</span>
0240 
0241 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0242 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0243 <span class="comment">%minimisation de la log-vraisemblance suivant l'algorithme choisi</span>
0244 <span class="keyword">switch</span> method_optim
0245     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0246     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0247     <span class="keyword">case</span> <span class="string">'simplex'</span>  <span class="comment">%methode du simplexe</span>
0248         fprintf(<span class="string">'||Simplex|| Initialisation au point:\n'</span>);
0249         fprintf(<span class="string">'%g '</span>,x0); fprintf(<span class="string">'\n'</span>);
0250         <span class="keyword">if</span> ~aff_warning;warning off all;<span class="keyword">end</span>
0251         [x, fmax, nf] = nmsmax(fun, x0, [], []);
0252         <span class="comment">%stockage retour algo</span>
0253         para_estim.out_algo.fmax=fmax;
0254         para_estim.out_algo.nf=nf;
0255         <span class="keyword">if</span> ~aff_warning;warning on all;<span class="keyword">end</span>
0256         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0257         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0258         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0259         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0260     <span class="keyword">case</span> <span class="string">'tir_min'</span>
0261         nb_pts=nb_para*50;
0262         type_tir=<span class="string">'LHS_O1'</span>;
0263         fprintf(<span class="string">'||Tir_min||  Tirage %s de %i points\n'</span>,type_tir,nb_pts);
0264         doePop.Xmin=lb;doePop.Xmax=ub;doePop.nb_samples=nb_pts;doePop.aff=false;doePop.type=type_tir;
0265         tir_pop=gene_doe(doePop);
0266         crit=zeros(1,nb_pts);
0267         parfor tir=1:nb_pts
0268             crit(tir)=fun(tir_pop(tir,:));
0269         <span class="keyword">end</span>
0270         [fval,IX]=min(crit);
0271         x=tir_pop(IX,:);
0272         
0273         <span class="comment">%stockage retour algo</span>
0274         para_estim.out_algo.fval=fval;
0275         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0276         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0277         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0278         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0279     <span class="keyword">case</span> <span class="string">'sqp'</span>
0280         fprintf(<span class="string">'||Fmincon (SQP)|| Initialisation au point:\n'</span>);
0281         fprintf(<span class="string">'%g '</span>,x0); fprintf(<span class="string">'\n'</span>);
0282         <span class="comment">%minimisation avec traitement de point de depart non defini</span>
0283         <span class="keyword">if</span> ~aff_warning;warning off all;<span class="keyword">end</span>
0284         <span class="comment">%pas de recherche d'initialisation</span>
0285         [x,fval,exitflag,output] = fmincon(fun,x0,[],[],[],[],lb,ub,[],options_sqp);
0286         <span class="comment">%arret minimisation</span>
0287         <span class="keyword">if</span> exitflag==1||exitflag==0||exitflag==2
0288             disp(<span class="string">'Arret'</span>)
0289             para_estim.out_algo=output;
0290             para_estim.out_algo.fval=fval;
0291             para_estim.out_algo.exitflag=exitflag;
0292             <span class="keyword">if</span> exist(<span class="string">'fval1'</span>,<span class="string">'var'</span>);para_estim.out_algo.fval1=fval1;<span class="keyword">end</span>
0293         <span class="keyword">elseif</span> exitflag==-2
0294             fprintf(<span class="string">'Bug arret SQP\n'</span>);
0295         <span class="keyword">end</span>
0296         <span class="keyword">if</span> ~aff_warning;warning on all;<span class="keyword">end</span>
0297         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0298         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0299         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0300         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0301     <span class="keyword">case</span> <span class="string">'fminbnd'</span>
0302         fprintf(<span class="string">'||Fminbnd|| Initialisation au point:\n'</span>);
0303         fprintf(<span class="string">'%g '</span>,x0); fprintf(<span class="string">'\n'</span>);
0304         <span class="comment">%minimisation</span>
0305         <span class="keyword">if</span> ~aff_warning;warning off all;<span class="keyword">end</span>
0306         [x,fval,exitflag,output] = fminbnd(fun,lb,ub,options_fminbnd);
0307         <span class="keyword">if</span> ~aff_warning;warning on all;<span class="keyword">end</span>
0308         <span class="comment">%arret minimisation</span>
0309         <span class="keyword">if</span> exitflag==1||exitflag==0||exitflag==2
0310             disp(<span class="string">'Arret'</span>)
0311             para_estim.out_algo=output;
0312             para_estim.out_algo.fval=fval;
0313             para_estim.out_algo.exitflag=exitflag;
0314             <span class="keyword">if</span> exist(<span class="string">'fval1'</span>,<span class="string">'var'</span>);para_estim.out_algo.fval1=fval1;<span class="keyword">end</span>
0315         <span class="keyword">elseif</span> exitflag==-2
0316             fprintf(<span class="string">'Bug arret SQP\n'</span>);
0317         <span class="keyword">end</span>
0318         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0319         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0320         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0321         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0322     <span class="keyword">case</span> <span class="string">'fminsearch'</span>
0323         fprintf(<span class="string">'||Fminsearch|| Initialisation au point:\n'</span>);
0324         fprintf(<span class="string">'%g '</span>,x0); fprintf(<span class="string">'\n'</span>);
0325         <span class="comment">%minimisation</span>
0326         [x,fval,exitflag,output] = fminsearch(fun,x0,options_fminsearch);
0327         <span class="comment">%arret minimisation</span>
0328         <span class="keyword">if</span> exitflag==1||exitflag==0||exitflag==2
0329             disp(<span class="string">'Arret'</span>)
0330             para_estim.out_algo=output;
0331             para_estim.out_algo.fval=fval;
0332             para_estim.out_algo.exitflag=exitflag;
0333             <span class="keyword">if</span> exist(<span class="string">'fval1'</span>,<span class="string">'var'</span>);para_estim.out_algo.fval1=fval1;<span class="keyword">end</span>
0334         <span class="keyword">elseif</span> exitflag==-2
0335             fprintf(<span class="string">'Bug arret Fminsearch\n'</span>);
0336         <span class="keyword">end</span>
0337         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0338         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0339         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0340         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0341     <span class="keyword">case</span> <span class="string">'fmincon'</span>
0342         fprintf(<span class="string">'||Fmincon|| Initialisation au point:\n'</span>);
0343         fprintf(<span class="string">'%g '</span>,x0); fprintf(<span class="string">'\n'</span>);
0344         <span class="comment">%minimisation avec traitement de point de depart non defini</span>
0345         <span class="keyword">if</span> ~aff_warning;warning off all;<span class="keyword">end</span>
0346         <span class="comment">%pas de recherche d'initialisation</span>
0347         [x,fval,exitflag,output] = fmincon(fun,x0,[],[],[],[],lb,ub,[],options_fmincon);
0348         <span class="comment">%arret minimisation</span>
0349         <span class="keyword">if</span> exitflag==1||exitflag==0||exitflag==2
0350             disp(<span class="string">'Arret'</span>)
0351             para_estim.out_algo=output;
0352             para_estim.out_algo.fval=fval;
0353             para_estim.out_algo.exitflag=exitflag;
0354             <span class="keyword">if</span> exist(<span class="string">'fval1'</span>,<span class="string">'var'</span>);para_estim.out_algo.fval1=fval1;<span class="keyword">end</span>
0355         <span class="keyword">elseif</span> exitflag==-2
0356             fprintf(<span class="string">'Bug arret Fmincon\n'</span>);
0357         <span class="keyword">end</span>
0358         <span class="keyword">if</span> ~aff_warning;warning on all;<span class="keyword">end</span>
0359         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0360         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0361         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0362         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0363     <span class="keyword">case</span> <span class="string">'ga'</span>
0364         fprintf(<span class="string">'||Ga|| Initialisation par tirages %s:\n'</span>,popInitManu);
0365         <span class="keyword">if</span> ~aff_warning;warning off all;<span class="keyword">end</span>
0366         [x,fval,exitflag,output] = ga(fun,nb_para_optim,[],[],[],[],lb,ub,[],options_ga);
0367         <span class="comment">%arret minimisation</span>
0368         <span class="keyword">if</span> exitflag==1||exitflag==0||exitflag==2
0369             disp(<span class="string">'Arret'</span>)
0370             para_estim.out_algo=output;
0371             para_estim.out_algo.fval=fval;
0372             para_estim.out_algo.exitflag=exitflag;
0373             <span class="keyword">if</span> exist(<span class="string">'fval1'</span>,<span class="string">'var'</span>);para_estim.out_algo.fval1=fval1;<span class="keyword">end</span>
0374         <span class="keyword">elseif</span> exitflag==-2
0375             fprintf(<span class="string">'Bug arret Ga\n'</span>);
0376         <span class="keyword">end</span>
0377         
0378         <span class="keyword">if</span> ~aff_warning;warning on all;<span class="keyword">end</span>
0379         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0380         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0381         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0382         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0383     <span class="keyword">case</span> <span class="string">'pso'</span>
0384         fprintf(<span class="string">'||PSOt|| Initialisation par tirages %s:\n'</span>,popInitManu);
0385         <span class="keyword">if</span> ~aff_warning;warning off all;<span class="keyword">end</span>
0386         <span class="comment">%PSOt version vectorisee</span>
0387         [pso_out,<span class="keyword">...</span><span class="comment">    %pt minimum et reponse associee</span>
0388             tr,<span class="keyword">...</span><span class="comment">      %pt minimum a chaque iteration</span>
0389             te<span class="keyword">...</span><span class="comment">       %epoch? iterations</span>
0390             ]=<a href="../../../GRENAT/routines/libs/PSOt/pso_Trelea_mod.html" class="code" title="function [OUT,varargout]=pso_Trelea_mod(functname,D,varargin)">pso_Trelea_mod</a>(<span class="keyword">...</span>
0391             fun,<span class="keyword">...</span><span class="comment">             %fonction</span>
0392             nb_para,<span class="keyword">...</span><span class="comment">         %nombre variables</span>
0393             PSOT_mv,<span class="keyword">...</span><span class="comment">         %vitesse maxi particules (def. 4)</span>
0394             PSOT_varrange,<span class="keyword">...</span><span class="comment">   %matrice des plages de variation des parametres</span>
0395             PSOT_minmax,<span class="keyword">...</span><span class="comment">     %minimisation (=0 def), maximisation (=1) ou autre (=2)</span>
0396             PSOT_options,<span class="keyword">...</span><span class="comment">    %vecteur options</span>
0397             PSOT_plot,<span class="keyword">...</span><span class="comment">       %fonction de tracee (optionnelle)</span>
0398             PSOT_tirage);       <span class="comment">%tirage initial aleatoire (=0) ou utilisateur (=1)</span>
0399         
0400         <span class="comment">%extraction infos</span>
0401         Xmin=pso_out(1:end-1)';
0402         Zmin=pso_out(end);
0403         exitflag=[];
0404         output.tr=tr;
0405         output.te=te;
0406         disp(<span class="string">'Arret'</span>)
0407         para_estim.out_algo=output;
0408         para_estim.out_algo.xval=Xmin;
0409         para_estim.out_algo.fval=Zmin;
0410         para_estim.out_algo.exitflag=exitflag;
0411         x=Xmin;
0412         <span class="keyword">if</span> ~aff_warning;warning on all;<span class="keyword">end</span>
0413         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0414         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0415         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0416         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0417     <span class="keyword">otherwise</span>
0418         error(<span class="string">'Strategie de minimisation non prise en charge'</span>);
0419 <span class="keyword">end</span>
0420 <a href="../../../GRENAT/routines/divers/mesu_time.html" class="code" title="function [tictoc_compt,tInit]=mesu_time(compteur,tps_init)">mesu_time</a>(tMesu,tInit);
0421 fprintf(<span class="string">' - - - - - - - - - - - - - - - - - - - - \n'</span>)
0422 <span class="comment">%stockage valeur parametres obtenue par minimisation</span>
0423 <span class="keyword">if</span> nb_para_optim&gt;nb_para
0424     para_estim.l_val=x(1:nb_para);
0425     para_estim.p_val=x(nb_para+1:end);
0426 <span class="keyword">else</span>
0427     para_estim.l_val=x;
0428 <span class="keyword">end</span>
0429 
0430 <span class="keyword">if</span> meta.norm
0431     para_estim.l_val_denorm=para_estim.l_val.*donnees.norm.std_tirages+donnees.norm.moy_tirages;
0432     fprintf(<span class="string">'\nValeur(s) longueur(s) de correlation'</span>);
0433     fprintf(<span class="string">' %6.4f'</span>,para_estim.l_val_denorm);
0434     fprintf(<span class="string">'\n'</span>);
0435 <span class="keyword">end</span>
0436 fprintf(<span class="string">'Valeur(s) longueur(s) de correlation (brut)'</span>);
0437 fprintf(<span class="string">' %6.4f'</span>,para_estim.l_val);
0438 fprintf(<span class="string">'\n\n'</span>);
0439 <span class="keyword">if</span> nb_para_optim&gt;nb_para
0440     fprintf(<span class="string">'Valeur(s) longueur(s) puissance(s)'</span>);
0441     fprintf(<span class="string">' %6.4f'</span>,para_estim.p_val);
0442     fprintf(<span class="string">'\n\n'</span>);
0443 <span class="keyword">end</span>
0444 fprintf(<span class="string">' - - - - - - - - - - - - - - - - - - - - \n'</span>)
0445 fprintf(<span class="string">' - - - - - - - - - - - - - - - - - - - - \n'</span>)
0446 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 27-Aug-2015 11:57:14 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>